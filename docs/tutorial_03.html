<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Tutorial 3: Spectral Windows, Scenes and Optical Properties ‚Äì RetrievalToolbox-Tutorials</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-378cb20c3aa1cc4871e1c59a4c10131c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">RetrievalToolbox-Tutorials</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./tutorial_01.html"> 
<span class="menu-text">Tutorial 1: Spectroscopy and Gases</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./tutorial_02.html"> 
<span class="menu-text">Tutorial 2: Creating an Atmosphere and Working with Physical Units</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./tutorial_03.html" aria-current="page"> 
<span class="menu-text">Tutorial 3: Spectral Windows, Scenes and Optical Properties</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#spectral-windows" id="toc-spectral-windows" class="nav-link" data-scroll-target="#spectral-windows"><span class="header-section-number">2</span> Spectral Windows</a>
  <ul class="collapse">
  <li><a href="#introduction-1" id="toc-introduction-1" class="nav-link" data-scroll-target="#introduction-1"><span class="header-section-number">2.1</span> Introduction</a></li>
  <li><a href="#wavelengths-and-wavenumbers" id="toc-wavelengths-and-wavenumbers" class="nav-link" data-scroll-target="#wavelengths-and-wavenumbers"><span class="header-section-number">2.2</span> Wavelengths and Wavenumbers</a></li>
  <li><a href="#illustration-of-a-spectral-window-and-its-relationship-to-spectral-samples" id="toc-illustration-of-a-spectral-window-and-its-relationship-to-spectral-samples" class="nav-link" data-scroll-target="#illustration-of-a-spectral-window-and-its-relationship-to-spectral-samples"><span class="header-section-number">2.3</span> Illustration of a Spectral Window and its Relationship to Spectral Samples</a></li>
  </ul></li>
  <li><a href="#scenes" id="toc-scenes" class="nav-link" data-scroll-target="#scenes"><span class="header-section-number">3</span> Scenes</a>
  <ul class="collapse">
  <li><a href="#first-step-towards-scenes" id="toc-first-step-towards-scenes" class="nav-link" data-scroll-target="#first-step-towards-scenes"><span class="header-section-number">3.1</span> First Step Towards Scenes</a></li>
  <li><a href="#intermission-dictionaries-in-julia" id="toc-intermission-dictionaries-in-julia" class="nav-link" data-scroll-target="#intermission-dictionaries-in-julia"><span class="header-section-number">3.2</span> Intermission: Dictionaries in Julia</a></li>
  <li><a href="#moving-on-to-scenes" id="toc-moving-on-to-scenes" class="nav-link" data-scroll-target="#moving-on-to-scenes"><span class="header-section-number">3.3</span> Moving On To Scenes</a></li>
  </ul></li>
  <li><a href="#optical-properties" id="toc-optical-properties" class="nav-link" data-scroll-target="#optical-properties"><span class="header-section-number">4</span> Optical Properties</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tutorial 3: Spectral Windows, Scenes and Optical Properties</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="7e31d2a6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Some set-up for this document</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">RetrievalToolbox;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> RE <span class="op">=</span> RetrievalToolbox;</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Plots;</span> default(fontfamily="Helvetica", <span class="bu">titlefontsize=10</span>, <span class="bu">labelfontsize=10)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Unitful;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>In the previous tutorial (<a href="./tutorial_02.html">Tutorial 2</a>), we have learned about atmospheres and which types of profiles and other objects they contain. Further, we have learned about the importance of dealing with physical units correctly, such that RetrievalToolbox can correctly do the necessary unit conversions for us.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Goal of this tutorial">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Goal of this tutorial
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this tutorial we will move to creating an actual retrieval scene, and define the extent of our spectral region of interest. This provides us with everything needed to peform some basic calculations that we then use to produce top-of-atmosphere radiances. We will also learn how RetrievalToolbox internally links objects of interest to establish some of the needed relationships between them.</p>
</div>
</div>
</section>
<section id="spectral-windows" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Spectral Windows</h1>
<section id="introduction-1" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="introduction-1"><span class="header-section-number">2.1</span> Introduction</h2>
<p>During the beginning stages of setting up a trace gas retrieval algorithm, we must choose the so-called spectral windows. Possibly known as ‚Äúfitting windows‚Äù or just ‚Äúwindows‚Äù, we mean a contiguous section of the spectral dimension, be it wavelength or wavenumber. RetrievalToolbox supports an arbitrary number of spectral windows that can be used for retrievals, and, apart from memory limitations, they can be of any size - so both micro-windows and larger broad-band windows are supported.</p>
<p>Spectral windows are best defined very early in the retrieval application, since many other RetrievalToolbox objects depend on it. The type structure itself is relatively straightforward: we have to give a name, which is purely for labelling purposes, and then provide the lower and upper limits in either wavelength or wavenumber space. The wavelength or wavenumber limits (denoted here as <code>ww_min</code> and <code>ww_max</code>) represent the ‚Äúwhat the user wants‚Äù spectral boundaries. The third argument, <code>ww_grid</code> is the underlying high-resolution grid. Users can freely choose this grid, it can have regular or irregular intervals, however it must extend beyond the spectral limits as given by <code>ww_min</code> and <code>ww_max</code>. The fourth argument (<code>ww_unit</code>) now defines the units of the spectral grid, and can be any length-type unit (for wavelengths), or any wavenumber unit (inverse length). Finally, the last argument defines a so-called reference point (<code>ww_reference</code>): this is a quantity used for a number of wavelength- (or wavenumber-) dependent objects. For example, if we want to define a surface reflectance that varies spectrally over the range of the spectral window, we likely need a reference point to anchor some polynomial expression.</p>
<p>Below is the list of type fields for the <code>SpectralWindow</code> type. Note that the basic constructor (the function that is called when you type <code>RE.SpectralWindow(...)</code>) does not require the <code>N_hires</code> field to be supplied, since it is automatically calculated from the supplied <code>ww_grid</code> parameter.</p>
<div class="callout callout-style-default callout-note callout-titled" title="SpectralWindow">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
SpectralWindow
</div>
</div>
<div class="callout-body-container callout-body">
<div id="d4fb7552" class="cell" data-execution_count="2">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="3">
<ul>
<li><code>window_name::String</code>: Label for this spectral window</li>
<li><code>ww_min::AbstractFloat</code>: This is the ‚Äòwhat user wants‚Äô lower limit</li>
<li><code>ww_max::AbstractFloat</code>: This is the ‚Äòwhat user wants‚Äô upper limit</li>
<li><code>ww_grid::Vector{T} where T&lt;:AbstractFloat</code>: Wavelength or wavenumber grid (high-resolution) at the instrument</li>
<li><code>ww_unit::Union{Unitful.Units{U, ùêã} where U, Unitful.Units{U, ùêã‚Åª¬π} where U}</code>: Wavelength or wavenumber unit</li>
<li><code>ww_reference::AbstractFloat</code>: Reference Œª or ŒΩ from SV elements which have spectral dependence</li>
<li><code>N_hires::Int64</code>: Number of high-resolution spectral elements</li>
</ul>
<p>A type to hold a spectral window</p>
</div>
</div>
</div>
</div>
<p>It is easier to understand the workings of the <code>SpectralWindow</code> type by example. First, we simply create a new object by calling the type constructor. The example below creates a window that is 1 nm wide with a rather crude spacing of 0.1 nm for demonstration purposes.</p>
<div id="8e34cb7d" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>wl_unit <span class="op">=</span> u<span class="st">"nm"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>wl_min <span class="op">=</span> <span class="fl">759.95</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>wl_max <span class="op">=</span> <span class="fl">760.25</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>wl_buffer <span class="op">=</span> <span class="fl">0.03</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>wl_spacing<span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>wl_grid <span class="op">=</span> <span class="fu">collect</span>(wl_min<span class="op">-</span>wl_buffer<span class="op">:</span>wl_spacing<span class="op">:</span>wl_max<span class="op">+</span>wl_buffer<span class="op">+</span>wl_spacing)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>swin1 <span class="op">=</span> RE.<span class="fu">SpectralWindow</span>(</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"O2A"</span>, <span class="co"># Label</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    wl_min, <span class="co"># Lower wavelength limit</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    wl_max, <span class="co"># Upper wavelength limit</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    wl_grid, <span class="co"># Hires-grid</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    wl_unit, <span class="co"># Wavelength unit</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    (wl_min <span class="op">+</span> wl_max) <span class="op">/</span> <span class="fl">2</span> <span class="co"># Reference at center</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>Spectral window: O2A
Boundaries: 759.95 to 760.25, in nm.
N = 37</code></pre>
</div>
</div>
<p>We can peek into the <code>swin1</code> object as usual, for example we can look at the actual underlying wavelength grid.</p>
<div id="b6cd0682" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show</span>(swin1.ww_grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[759.9200000000001, 759.9300000000001, 759.94, 759.95, 759.96, 759.97, 759.98, 759.9900000000001, 760.0000000000001, 760.0100000000001, 760.0200000000001, 760.0300000000001, 760.0400000000001, 760.0500000000001, 760.0600000000001, 760.07, 760.08, 760.09, 760.1, 760.1100000000001, 760.1200000000001, 760.1300000000001, 760.1400000000001, 760.1500000000001, 760.1600000000001, 760.1700000000001, 760.1800000000001, 760.19, 760.2, 760.21, 760.22, 760.23, 760.2400000000001, 760.2500000000001, 760.2600000000001, 760.2700000000001, 760.2800000000001]</code></pre>
</div>
</div>
<p>The role of the wavelength grid is quite important: all optical property and radiative transfer calculations will be performed on that grid. Overall computing performance tends to scale linearly with the number of points in the spectral grid - so doubling the number of points of the spectral window rougly leads to a doubling of the overall forward model execution time.</p>
</section>
<section id="wavelengths-and-wavenumbers" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="wavelengths-and-wavenumbers"><span class="header-section-number">2.2</span> Wavelengths and Wavenumbers</h2>
<p>RetrievalToolbox supports both wavelength and wavenumbers as choices for the spectral dimension natively. Additional details are also found in the RetrievalToolbox documentation at [ADD LINK].</p>
<p>Users should be able to access the spectral dimension in an explicit way that reflects their initial choice and that helps other users to be constantly aware of whether this particular bit of code was intended for wavelength or wavenumber space. We can access the wavelength-based grid in <code>swin1</code> as we have done above (<code>swin1.ww_grid</code>), but it is much cleaner to write <code>.wavelength_grid</code>!</p>
<div id="6bfbe974" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show</span>(swin1.wavelength_grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[759.9200000000001, 759.9300000000001, 759.94, 759.95, 759.96, 759.97, 759.98, 759.9900000000001, 760.0000000000001, 760.0100000000001, 760.0200000000001, 760.0300000000001, 760.0400000000001, 760.0500000000001, 760.0600000000001, 760.07, 760.08, 760.09, 760.1, 760.1100000000001, 760.1200000000001, 760.1300000000001, 760.1400000000001, 760.1500000000001, 760.1600000000001, 760.1700000000001, 760.1800000000001, 760.19, 760.2, 760.21, 760.22, 760.23, 760.2400000000001, 760.2500000000001, 760.2600000000001, 760.2700000000001, 760.2800000000001]</code></pre>
</div>
</div>
<div id="6e8f6a5c" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show</span>(swin1.Œª_grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[759.9200000000001, 759.9300000000001, 759.94, 759.95, 759.96, 759.97, 759.98, 759.9900000000001, 760.0000000000001, 760.0100000000001, 760.0200000000001, 760.0300000000001, 760.0400000000001, 760.0500000000001, 760.0600000000001, 760.07, 760.08, 760.09, 760.1, 760.1100000000001, 760.1200000000001, 760.1300000000001, 760.1400000000001, 760.1500000000001, 760.1600000000001, 760.1700000000001, 760.1800000000001, 760.19, 760.2, 760.21, 760.22, 760.23, 760.2400000000001, 760.2500000000001, 760.2600000000001, 760.2700000000001, 760.2800000000001]</code></pre>
</div>
</div>
<p>With both the unicode lowercase ‚Äúlambda‚Äù (<code>Œª_grid</code>) and <code>wavelength_grid</code> we can access the underlying wavelength grid. The same holds for wavenumber-based spectral windows. Let us define a new window:</p>
<div id="e5352e3d" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>wn_unit <span class="op">=</span> u<span class="st">"cm^-1"</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>wn_min <span class="op">=</span> <span class="fl">5000.0</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>wn_max <span class="op">=</span> <span class="fl">5001.0</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>wn_buffer <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>wn_spacing<span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>wn_grid <span class="op">=</span> <span class="fu">collect</span>(wn_min<span class="op">-</span>wn_buffer<span class="op">:</span>wn_spacing<span class="op">:</span>wn_max<span class="op">+</span>wn_buffer)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>swin2 <span class="op">=</span> RE.<span class="fu">SpectralWindow</span>(</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"just_test"</span>, <span class="co"># Label</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    wn_min, <span class="co"># Lower wavenumber limit</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    wn_max, <span class="co"># Upper wavenumber limit</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    wn_grid, <span class="co"># Hires-grid</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    wn_unit, <span class="co"># Wavenumber unit</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    (wn_min <span class="op">+</span> wn_max) <span class="op">/</span> <span class="fl">2</span> <span class="co"># Reference at center</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>Spectral window: just_test
Boundaries: 5000.0 to 5001.0, in cm‚Åª¬π.
N = 121</code></pre>
</div>
</div>
<p>and now access the underlying grid using <code>wavenumber_grid</code> or the lower case greek nu <code>ŒΩ_grid</code>:</p>
<div id="a7c17e6e" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show</span>(swin2.wavenumber_grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[4999.9, 4999.91, 4999.92, 4999.93, 4999.94, 4999.95, 4999.96, 4999.97, 4999.98, 4999.99, 5000.0, 5000.01, 5000.02, 5000.03, 5000.04, 5000.05, 5000.06, 5000.07, 5000.08, 5000.09, 5000.1, 5000.11, 5000.12, 5000.13, 5000.14, 5000.15, 5000.16, 5000.17, 5000.18, 5000.19, 5000.2, 5000.21, 5000.22, 5000.23, 5000.24, 5000.25, 5000.26, 5000.27, 5000.28, 5000.29, 5000.3, 5000.31, 5000.32, 5000.33, 5000.34, 5000.35, 5000.36, 5000.37, 5000.38, 5000.39, 5000.4, 5000.41, 5000.42, 5000.43, 5000.44, 5000.45, 5000.46, 5000.47, 5000.48, 5000.49, 5000.5, 5000.51, 5000.52, 5000.53, 5000.54, 5000.55, 5000.56, 5000.57, 5000.58, 5000.59, 5000.6, 5000.61, 5000.62, 5000.63, 5000.64, 5000.65, 5000.66, 5000.67, 5000.68, 5000.69, 5000.7, 5000.71, 5000.72, 5000.73, 5000.74, 5000.75, 5000.76, 5000.77, 5000.78, 5000.79, 5000.8, 5000.81, 5000.82, 5000.83, 5000.84, 5000.85, 5000.86, 5000.87, 5000.88, 5000.89, 5000.9, 5000.91, 5000.92, 5000.93, 5000.94, 5000.95, 5000.96, 5000.97, 5000.98, 5000.99, 5001.0, 5001.01, 5001.02, 5001.03, 5001.04, 5001.05, 5001.06, 5001.07, 5001.08, 5001.09, 5001.1]</code></pre>
</div>
</div>
<div id="c0b75af9" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show</span>(swin2.ŒΩ_grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[4999.9, 4999.91, 4999.92, 4999.93, 4999.94, 4999.95, 4999.96, 4999.97, 4999.98, 4999.99, 5000.0, 5000.01, 5000.02, 5000.03, 5000.04, 5000.05, 5000.06, 5000.07, 5000.08, 5000.09, 5000.1, 5000.11, 5000.12, 5000.13, 5000.14, 5000.15, 5000.16, 5000.17, 5000.18, 5000.19, 5000.2, 5000.21, 5000.22, 5000.23, 5000.24, 5000.25, 5000.26, 5000.27, 5000.28, 5000.29, 5000.3, 5000.31, 5000.32, 5000.33, 5000.34, 5000.35, 5000.36, 5000.37, 5000.38, 5000.39, 5000.4, 5000.41, 5000.42, 5000.43, 5000.44, 5000.45, 5000.46, 5000.47, 5000.48, 5000.49, 5000.5, 5000.51, 5000.52, 5000.53, 5000.54, 5000.55, 5000.56, 5000.57, 5000.58, 5000.59, 5000.6, 5000.61, 5000.62, 5000.63, 5000.64, 5000.65, 5000.66, 5000.67, 5000.68, 5000.69, 5000.7, 5000.71, 5000.72, 5000.73, 5000.74, 5000.75, 5000.76, 5000.77, 5000.78, 5000.79, 5000.8, 5000.81, 5000.82, 5000.83, 5000.84, 5000.85, 5000.86, 5000.87, 5000.88, 5000.89, 5000.9, 5000.91, 5000.92, 5000.93, 5000.94, 5000.95, 5000.96, 5000.97, 5000.98, 5000.99, 5001.0, 5001.01, 5001.02, 5001.03, 5001.04, 5001.05, 5001.06, 5001.07, 5001.08, 5001.09, 5001.1]</code></pre>
</div>
</div>
<p>Now what would happen if we tried to access a wavelength-based grid using <code>ŒΩ</code> or <code>wavenumber</code>?</p>
<div id="d2e571c2" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>swin1.wavenumber_grid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>Wrong unit! Expected wavelength, but got ŒΩ.

Stacktrace:
 [1] <span class="ansi-bold">error</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">s</span>::String<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">   @</span> <span class="ansi-bright-black-fg">Base</span> <span class="ansi-bright-black-fg">./</span><span style="text-decoration:underline" class="ansi-bright-black-fg">error.jl:35</span>
 [2] <span class="ansi-bold">getproperty</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">s</span>::SpectralWindow<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">x</span>::Symbol<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">   @</span> <span class="ansi-magenta-fg">RetrievalToolbox</span> <span class="ansi-bright-black-fg">./</span><span style="text-decoration:underline" class="ansi-bright-black-fg">none:36</span>
 [3] top-level scope
<span class="ansi-bright-black-fg">   @</span> <span style="text-decoration:underline" class="ansi-bright-black-fg">In[11]:1</span></pre>
</div>
</div>
</div>
<p>We receive an error! RetrievalToolbox clearly is aware of the fact that <code>swin1</code> was created with a wavelength-compatible unit and throws an error if we attempt to access the underlying grid with a symbol that was meant for wavenumber-compatible objects. This is very deliberate design! Users are encouraged to use <code>wavenumber_grid</code> or <code>wavelength_grid</code> in their codes as to make it clear that it was designed to operate in that particular spectral space. In applications where wavelength and wavenumber are expected to switch often, using <code>ww_grid</code> might be appropriate.</p>
<p>Within RetrievalToolbox, the string <code>ww</code> has a special meaning when it comes to type fields. It signals that users can access any quantity that contains <code>ww</code> fully or partially as a type field, using <code>wavelength</code> (or <code>Œª</code>) or <code>wavenumber</code> (or <code>ŒΩ</code>) by replacing <code>ww</code> with the appropriate symbol. For example, <code>swin1.ww_min</code>, <code>swin1.wavelength_min</code> and <code>swin1.Œª_min</code> all access the same object field.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Every RetrievalToolbox type field that starts with <code>ww</code> is intended to be used in either wavelength or wavenumber space! Users can access those fields by replacing the <code>ww</code> part of the type field symbol with either <code>wavelength</code> or <code>Œª</code> for length-compatible spectral units (such as ¬µm), or with either <code>wavenumber</code> or <code>ŒΩ</code> for wavenumber-compatible spectral units (such as cm^-1). For example, the type field <code>.ww_unit</code> can be equivalently accessed as <code>.ŒΩ_unit</code> if the object was created with a wavenumber-compatible unit! There are no known significant performance penalties to doing so.</p>
</div>
</div>
</section>
<section id="illustration-of-a-spectral-window-and-its-relationship-to-spectral-samples" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="illustration-of-a-spectral-window-and-its-relationship-to-spectral-samples"><span class="header-section-number">2.3</span> Illustration of a Spectral Window and its Relationship to Spectral Samples</h2>
<p>In <a href="#fig-specwin_disp" class="quarto-xref">Figure&nbsp;1</a>, we can see the components of a spectral window, and in this case we have chosen wavelength space for the spectral dimension.</p>
<p>The blue line with triangle-shaped markers represents a measurement which is discretized in the spectral dimension into <strong>spectral samples</strong>. Counting up all triangles in <a href="#fig-specwin_disp" class="quarto-xref">Figure&nbsp;1</a>, there are 30 spectral samples visible in this plot.</p>
<p>When choosing the limits of the spectral window, we usually do that based on the inclusion or exclusion of features in the absorption spectrum. Here, the choice is (without further meaning, just as an example) that we include an absorption feature at ~760.1 nm as well as the surrounding two ‚Äúhumps‚Äù. The vertical, gray lines indicate the location of the window limits, as stored in the <code>.wavelength_min</code> and <code>.wavelength_max</code> fields. This window contains 18 spectral samples of the measurement. The red dots that overlap the x-axis represent an illustration of the high-resolution grid that is stored in <code>.wavelength_grid</code> - these are the spectral points at which the model spectrum will be evaluated. Finally, the gray, dashed line at 760.1 nm represents the reference wavelength <code>.wavelength_ref</code>, which we chose to be at the center of the spectral window. Note that the reference wavelength can be any wavelength and it does not need to be inside the spectral window. Usually, the spectral window center or one of the limits is a convenient choice.</p>
<div id="fig-specwin_disp" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-specwin_disp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/specwin_disp.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-specwin_disp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Illustrating the main components of a spectral window, and how they relate to a measurement (blue triangles).
</figcaption>
</figure>
</div>
<p>Also note that the high-resolution grid does not need to line up at all with the spectral window limits - it just happens to be due to the way we constructed the window. We see the high-resolution grid extend a few intervals beyond the limits - this is required for a successful retrieval! When the instrument spectral response function is applied later on, the high-resolution grid must contain enough data in the spectral dimension such that a forward computation for every spectral sample (blue triangle) can be calculated. Below is an illustration to better visualize this concept (<a href="#fig-specwin_limit" class="quarto-xref">Figure&nbsp;2</a>).</p>
<div id="fig-specwin_limit" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-specwin_limit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/specwin_limit.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-specwin_limit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: This figure illustrates the neccessity of the high-resolution grid (red dots) to extend beyond the lower wavelength limit of the window (gray vertical line). An example spectral sample (blue triangle) takes spectral contributions from outside the window limits due to the finite width of the spectral response function (ISRF, black), so we must have model calculations for those out-of-window wavelengths.
</figcaption>
</figure>
</div>
</section>
</section>
<section id="scenes" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Scenes</h1>
<section id="first-step-towards-scenes" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="first-step-towards-scenes"><span class="header-section-number">3.1</span> First Step Towards Scenes</h2>
<p>We now ready to move up yet another level in the RetrievalToolbox hiearchy and create a so-called <em>scene</em>. Conceptually, a scene is meant to describe state of the atmosphere and surface(s) along with a number of additional parameters which puts that state into context with the observing instrument (or the measurement).</p>
<p>The most important component of the scene is the atmosphere, which we have discussed in the previous tutorial (<a href="./tutorial_02.html">Tutorial 2</a>). It contains the set-up for our vertical retrieval grid, meteorological profiles, gases and other constituents.</p>
<p>Along with the atmosphere, we must also define the surface state(s). At the moment, RetrievalToolbox requires a surface object to be attached to every spectral window that will be considered. We can easily instantiate a new Lambertian surface with the following code:</p>
<div id="8c228ac5" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>surf <span class="op">=</span> RE.<span class="fu">LambertianPolynomialSurface</span>(swin1, [<span class="fl">0.25</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>LambertianPolynomialSurface{Float64}(SpectralWindow: O2A, 0, [0.25])</code></pre>
</div>
</div>
<p>We must assign the surface to a spectral window, which is the first argument. The second argument in this function is the list of polynomial coefficients. For the sake of simplicity we create a spectrally flat surface, and thus only need one polynomial coefficient - the zeroth order value. The <code>LambertianPolynomialSurface</code> surface type might at a later stage trigger the calculation of surface reflecticity for all high-res spectral points for the spectral window, which requires the evaluation of the albedo <span class="math inline">\rho</span> at all spectral points:</p>
<p><span class="math display">
\rho(\lambda) = \sum_{i=0}^{N-1} (\lambda - \lambda_\mathrm{ref})^i
</span></p>
<p>The reference wavelength <span class="math inline">\lambda_\mathrm{ref}</span> will be taken from the <code>swin1.ww_reference</code> field.</p>
<p>At first glance, it seems like a circular dependency, but the scene object we want to create later on requires a so-called dictionary that maps a spectral window onto a surface:</p>
<div id="fe3d1a45" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>surf_dict <span class="op">=</span> <span class="fu">Dict</span>(swin1 <span class="op">=&gt;</span> surf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>Dict{SpectralWindow{Float64}, LambertianPolynomialSurface{Float64}} with 1 entry:
  SpectralWindow: O2A =&gt; LambertianPolynomialSurface{Float64}(SpectralWindow: O‚Ä¶</code></pre>
</div>
</div>
<p>The next short section explains how dictionaries in Julia work, and why they are a useful tool for RE. Even experienced Julia users might want to read through this sub-section.</p>
</section>
<section id="intermission-dictionaries-in-julia" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="intermission-dictionaries-in-julia"><span class="header-section-number">3.2</span> Intermission: Dictionaries in Julia</h2>
<p>Dictionaries in Julia work exactly like those in e.g.&nbsp;Python: they allow one to store the relationship between key and value pairs, mostly for the purpose of accessing some value with a given key. They can be easily created via typing e.g.</p>
<div id="7a08a3dd" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="op">=</span> <span class="fu">Dict</span>(<span class="st">"key1"</span> <span class="op">=&gt;</span> <span class="fl">1</span>, <span class="st">"key2"</span> <span class="op">=&gt;</span> <span class="fl">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>Dict{String, Int64} with 2 entries:
  "key2" =&gt; 3
  "key1" =&gt; 1</code></pre>
</div>
</div>
<p>In Julia, dictionaries are objects of types, so in the example above we have created a dictionary that maps strings onto integers. This is quite different when compared to Python. If we attempt to store a new key-value pair in this already existing dictionary, we find that it only works if we provide a string-based key and an integer-based value (or one that can be implicity converted to one)!</p>
<div id="c4b8d4d0" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>d1[<span class="st">"key3"</span>] <span class="op">=</span> <span class="fl">8</span> <span class="co"># This works</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>d1[<span class="st">"key4"</span>] <span class="op">=</span> <span class="fl">1.0</span> <span class="co"># This works too (conversion float -&gt; integer succeeds)</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>d1[<span class="fl">10</span>] <span class="op">=</span> <span class="st">"key5"</span> <span class="co"># This does not (integer -&gt; string fails, string -&gt; float fails)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>MethodError: Cannot `convert` an object of type <span class="ansi-bright-green-fg">Int64</span> to an object of type <span class="ansi-bright-red-fg">String</span>
The function `convert` exists, but no method is defined for this combination of argument types.

Closest candidates are:
  convert(::Type{String}, <span class="ansi-bright-red-fg">::Base.JuliaSyntax.Kind</span>)
<span class="ansi-bright-black-fg">   @</span> <span class="ansi-bright-black-fg">Base</span> <span class="ansi-bright-black-fg">/Users/julia/.julia/scratchspaces/a66863c6-20e8-4ff4-8a62-49f30b1f605e/agent-cache/default-macmini-x64-5.0/build/default-macmini-x64-5-0/julialang/julia-master/base/JuliaSyntax/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">kinds.jl:975</span>
  convert(::Type{String}, <span class="ansi-bright-red-fg">::String</span>)
<span class="ansi-bright-black-fg">   @</span> <span class="ansi-bright-black-fg">Base</span> <span style="text-decoration:underline" class="ansi-bright-black-fg">essentials.jl:461</span>
  convert(::Type{T}, <span class="ansi-bright-red-fg">::T</span>) where T&lt;:AbstractString
<span class="ansi-bright-black-fg">   @</span> <span class="ansi-bright-black-fg">Base</span> <span class="ansi-bright-black-fg">strings/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">basic.jl:231</span>
  ...


Stacktrace:
 [1] <span class="ansi-bold">setindex!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">h</span>::Dict<span class="ansi-bright-black-fg">{String, Int64}</span>, <span class="ansi-bright-black-fg">v0</span>::String, <span class="ansi-bright-black-fg">key0</span>::Int64<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">   @</span> <span class="ansi-bright-black-fg">Base</span> <span class="ansi-bright-black-fg">./</span><span style="text-decoration:underline" class="ansi-bright-black-fg">dict.jl:346</span>
 [2] top-level scope
<span class="ansi-bright-black-fg">   @</span> <span style="text-decoration:underline" class="ansi-bright-black-fg">In[15]:5</span></pre>
</div>
</div>
</div>
<p>If we want to create a dictionary that allows us to use any type for either key or value, we must initially create it as such:</p>
<div id="eb98c25b" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="op">=</span> <span class="fu">Dict</span><span class="dt">{Any,Any}</span>()</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>d2[<span class="st">"key1"</span>] <span class="op">=</span> <span class="fl">123</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>d2[<span class="fl">3.2</span>] <span class="op">=</span> <span class="st">"test"</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>d2[(<span class="fl">10</span>, <span class="ch">'a'</span>)] <span class="op">=</span> sin</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>d2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>Dict{Any, Any} with 3 entries:
  (10, 'a') =&gt; sin
  3.2       =&gt; "test"
  "key1"    =&gt; 123</code></pre>
</div>
</div>
<p>The dictionary <code>d2</code> can be populated with almost anything now - the example above shows a string mapped to an integer (<code>"key1" =&gt; 1</code>), a 64-bit float mapped to a string (<code>3.2 =&gt; "test</code>), and finally a tuple mapped to a function (<code>(10, 'a') =&gt; sin</code>)!</p>
<p>As always, when it comes to codes that are required to perform very efficiently, one would be wise to steer clear of any data type with <code>Any</code>, since the Julia compiler cannot dispatch specific functions for good performance. However, for most applications the performance for <code>Any</code>-type dictionaries is usually good enough and can be a very convenient way of organizing relationships.</p>
<p>One can iterate over dictionaries in the following way:</p>
<div id="350daf8f" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k,v) <span class="kw">in</span> d1 <span class="co"># The braces around k,v are required!</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"Key </span><span class="sc">$</span>(k)<span class="st"> and Value </span><span class="sc">$</span>(v)<span class="st">"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key key2 and Value 3
Key key3 and Value 8
Key key1 and Value 1
Key key4 and Value 1</code></pre>
</div>
</div>
<p>We can already notice something interesting! The order in which the key-value pairs are read out is not the same as the order in which they were added to the dictionary! This is a very important detail about dictionaries in Julia: they are, as of writing of this document, not ordered by insertion and there is no guarantee that the order is preserved between executions of the script. If users need that functionality, there is a Julia package <a href="https://juliacollections.github.io/OrderedCollections.jl/latest/ordered_containers.html">OrderedCollections.jl</a>, which implements an order-preserving dictionary type.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Dictionaries in Python (3.7 and up) preserve the order of insertion! In Julia, this is not the case, and the <strong>iteration order is not guaranteed!</strong></p>
</div>
</div>
<p>In many scripting applications, we would use dictionaries in a manner like above where we link strings or integers to other, generally simple objects. In Julia, many more types can be used as dictionary keys, not just numbers, strings or tuples. We can even use our own types! We will use a quick example by creating two new custom types, and use variables of those types as keys in dictionaries.</p>
<div id="d5b29aa7" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> SS1</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    x</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> SS2</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    y</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>s1 <span class="op">=</span> <span class="fu">SS1</span>([<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>])</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>s2 <span class="op">=</span> <span class="fu">SS2</span>([<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>])</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>test_dict <span class="op">=</span> <span class="fu">Dict</span>(s1 <span class="op">=&gt;</span> <span class="st">"I am s1"</span>, s2 <span class="op">=&gt;</span> <span class="st">"I am s2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>Dict{Any, String} with 2 entries:
  SS1([1, 2, 3]) =&gt; "I am s1"
  SS2([4, 5, 6]) =&gt; "I am s2"</code></pre>
</div>
</div>
<p>These are very simple user types that take one argument each. We can access the contents of the dictionary as follows:</p>
<div id="6461d009" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>test_dict[s1]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>"I am s1"</code></pre>
</div>
</div>
<p>This feels like expected behavior! We have created a dictionary with some keys, one of those keys is indeed our newly created object <code>s1</code>, so we should be able to access the value <code>"I am s1</code>‚Äù inside <code>test_dict</code> simply by writing <code>test_dict[s1]</code>. And we see that it works.</p>
<p>Let us try something very similar: we will create a new object, that is seeminly the same object, and try to access the dictonary in exactly the same way. However, we will see that Julia raises an error!</p>
<div id="13c36c3b" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>s3 <span class="op">=</span> <span class="fu">SS1</span>([<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>])</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>test_dict[s3]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>KeyError: key SS1([1, 2, 3]) not found

Stacktrace:
 [1] <span class="ansi-bold">getindex</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">h</span>::Dict<span class="ansi-bright-black-fg">{Any, String}</span>, <span class="ansi-bright-black-fg">key</span>::SS1<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">   @</span> <span class="ansi-bright-black-fg">Base</span> <span class="ansi-bright-black-fg">./</span><span style="text-decoration:underline" class="ansi-bright-black-fg">dict.jl:477</span>
 [2] top-level scope
<span class="ansi-bright-black-fg">   @</span> <span style="text-decoration:underline" class="ansi-bright-black-fg">In[20]:2</span></pre>
</div>
</div>
</div>
<p>The underlying reason as to why the above code raises an error is <strong>very important to understand</strong>! Julia dictionaries are, just like in Python, hash tables. We can use Julia‚Äôs <code>Base.hash</code> function to calculate the hash value of our variables <code>s1</code> and <code>s3</code>, as well as another object that we just create:</p>
<div id="d0996cb7" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(<span class="bu">Base</span>.<span class="fu">hash</span>(s1))</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(<span class="bu">Base</span>.<span class="fu">hash</span>(s3))</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(<span class="bu">Base</span>.<span class="fu">hash</span>(<span class="fu">SS1</span>([<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0xd3256f4cbd6b88c7</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>0xa67b1e294f794022</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>0xb9639bd757443af7</code></pre>
</div>
</div>
<p>Even though all three objects have the same contents in the sense that the values of the arrays <code>[1,2,3]</code> are the same, they produce different hash values! This is due to the fact that the creation of the array <code>[1,2,3]</code> happens on stack memory. So whenever we type <code>[1,2,3]</code> a new array is created at some different part of the memory that is available to Julia.</p>
<p>If wanted, we can circumvent this by first creating an array, and <em>afterwards</em> create two objects with that array as the argument:</p>
<div id="ca1c1192" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> [<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>]</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>s4 <span class="op">=</span> <span class="fu">SS1</span>(a)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>s5 <span class="op">=</span> <span class="fu">SS1</span>(a)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(<span class="fu">hash</span>(s4))</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(<span class="fu">hash</span>(s5))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0xaa5a859f10b63ba1</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>0xaa5a859f10b63ba1</code></pre>
</div>
</div>
<p>We see that the hash value for both <code>s4</code> and <code>s5</code> is the same, and Julia cannot differentiate those two objects at all. Therefore, we could use either to access a dictionary:</p>
<div id="475ac776" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>test_dict2 <span class="op">=</span> <span class="fu">Dict</span>(s4 <span class="op">=&gt;</span> <span class="st">"I am s4"</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>test_dict2[s5]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>"I am s4"</code></pre>
</div>
</div>
</section>
<section id="moving-on-to-scenes" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="moving-on-to-scenes"><span class="header-section-number">3.3</span> Moving On To Scenes</h2>
<p>Returning back to where we left off before the intermission. There, we created a dictionary that maps our <code>swin1</code> object of type <code>SpectralWindow</code> onto the Lambertian surface that we also created beforehand.</p>
<div id="41750c02" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>surf_dict <span class="op">=</span> <span class="fu">Dict</span>(swin1 <span class="op">=&gt;</span> surf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>Dict{SpectralWindow{Float64}, LambertianPolynomialSurface{Float64}} with 1 entry:
  SpectralWindow: O2A =&gt; LambertianPolynomialSurface{Float64}(SpectralWindow: O‚Ä¶</code></pre>
</div>
</div>
<p>We now understand how <code>surf_dict</code> can be used to access the <code>surf</code> object via <code>swin1</code>. Spectral windows in RetrievalToolbox have arrays in them, so even if we have two separate windows that happen to have the same properties, our <code>swin1</code> object has a unique hash.</p>
<p>We still need a few objects before we can create our scene. Next is the observer. We have to define what type of observation we want to connect to this scene - this is (for now) mostly for the purposes of radiative transfer computations which produce different outputs, depending on the observer type. If we want to use measurements from a space-based instrument, we can use the <code>SatelliteObserver</code> type:</p>
<div id="5753841f" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>observer <span class="op">=</span> RE.<span class="fu">SatelliteObserver</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="fl">1.0</span>, <span class="co"># Viewing zenith</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="fl">110.0</span>, <span class="co"># Viewing azimuth</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">zeros</span>(<span class="fl">3</span>), <span class="co"># Satellite velocity</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">zeros</span>(<span class="fl">3</span>) <span class="co"># Satellite position</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>SatelliteObserver{Float64, Float64}(1.0, 110.0, [0.0, 0.0, 0.0], [0.0, 0.0, 0.0])</code></pre>
</div>
</div>
<p>We fill these in with some plausible values. Note that the satellite velocity and satellite position fields are currently unused, so we can safely fill them with zeros. Here we also want to point users the RetrievalToolbox documentation about the problematic ambiguities regarding angular units: [link to RetrievalToolbox doc]. All angular units, such as zenith and azimuth angles, should be entered as degrees without any <code>Unitful</code> units attached to them as to avoid any implicit unwanted unit conversions between degrees and radians.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Be aware of implicit angular unit conversions when using <code>Unitful</code> degree units!</p>
</div>
</div>
<p>The next required object is a location, and for this exercise we opt for an <code>EarthLocation</code> type, which describes the position on Earth at which the instrument points. Currently, these Earth locations are considered to be point-like, meaning that they do not have any spatial extent. This notion is consistent with the utilized 1-dimensional radiative transfer, so any location represents some idea of a mean atmospheric and surface state of the area covered by the field-of-view of the ground footprint.</p>
<div id="1b095194" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>location <span class="op">=</span> RE.<span class="fu">EarthLocation</span>(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="fl">16.3713</span>,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="fl">48.2081</span>,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="fl">200.0</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    u<span class="st">"m"</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>EarthLocation
Longitude: 16.3713
Latitude:  48.2081
Altitude:  200.0 m</code></pre>
</div>
</div>
<p>The last separate object needed is a simple <code>DateTime</code>, which is an object type that is part of the Julia standard library to represent a time. It requires loading in a module first, however:</p>
<div id="509676e5" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Dates</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> <span class="fu">DateTime</span>(<span class="st">"2025-02-19T13:00:00"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>2025-02-19T13:00:00</code></pre>
</div>
</div>
<p>Again, we picked an arbitrary date. So far, the only function which needs this particular data (<code>EarthScene.time</code>) is a function that can calculate the solar Doppler shift between the sun and the Earth location (if explicitly needed).</p>
<p>We now have all the components needed to create a scene object. We re-use the code we wrote in the previous tutorial to produce an atmosphere object (<a href="./tutorial_02.html">Tutorial 2</a>). Readers can un-fold the code cell below to look at the details.</p>
<div id="55cb41f2" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>atm <span class="op">=</span> RE.<span class="fu">create_empty_EarthAtmosphere</span>(</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="fl">4</span>, <span class="co"># number of levels for retrieval grid</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="fl">6</span>, <span class="co"># number of levels for MET grid</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Float64</span>, <span class="co"># data type for all arrays</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    u<span class="st">"hPa"</span>, <span class="co"># pressure unit for retrieval grid</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    u<span class="st">"Pa"</span>, <span class="co"># pressure unit for MET grid</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    u<span class="st">"K"</span>, <span class="co"># unit for temperature profile</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    u<span class="st">"g/kg"</span>, <span class="co"># unit for specific humidity profile</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    u<span class="st">"km"</span>, <span class="co"># unit for altitude profile</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    u<span class="st">"m/s^2"</span>, <span class="co"># unit for local gravity profile</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>RE.<span class="fu">ingest!</span>(atm, <span class="op">:</span>pressure_levels, [<span class="fl">1</span>., <span class="fl">100</span>., <span class="fl">500</span>., <span class="fl">1000</span>.]u<span class="st">"hPa"</span>)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>RE.<span class="fu">ingest!</span>(atm, <span class="op">:</span>met_pressure_levels, [<span class="fl">5</span>., <span class="fl">65</span>., <span class="fl">200</span>., <span class="fl">400</span>., <span class="fl">650</span>., <span class="fl">950</span>.]u<span class="st">"hPa"</span>)</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>RE.<span class="fu">ingest!</span>(atm, <span class="op">:</span>specific_humidity_levels, [<span class="fl">0.0001</span>, <span class="fl">0.0002</span>, <span class="fl">0.00035</span>, <span class="fl">0.00035</span>, <span class="fl">0.00075</span>, <span class="fl">0.0020</span>]u<span class="st">"kg/kg"</span>)</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>RE.<span class="fu">ingest!</span>(atm, <span class="op">:</span>temperature_levels, [<span class="fl">253</span>., <span class="fl">233</span>., <span class="fl">238</span>., <span class="fl">253</span>., <span class="fl">278</span>., <span class="fl">293</span>.]u<span class="st">"K"</span>)</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>RE.<span class="fu">calculate_layers!</span>(atm)</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the spectroscopy</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>absco_o2 <span class="op">=</span> RE.<span class="fu">load_ABSCO_spectroscopy</span>(</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">joinpath</span>(<span class="st">"data"</span>, <span class="st">"o2_spectroscopy_demo.h5"</span>)</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the gas object</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>gas_o2 <span class="op">=</span> RE.<span class="fu">GasAbsorber</span>(</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"O2"</span>,</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>    absco_o2,</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.2095</span>, <span class="fl">0.2095</span>, <span class="fl">0.2095</span>, <span class="fl">0.2095</span>],</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>    Unitful.NoUnits</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a><span class="co"># push into our list of atmosphere objects</span></span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a><span class="fu">push!</span>(atm.atm_elements, gas_o2);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="7ef06568" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>scene <span class="op">=</span> RE.<span class="fu">EarthScene</span>(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    atm, <span class="co"># Atmosphere</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    surf_dict, <span class="co"># Surface(s)</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    observer, <span class="co"># Observer</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    location, <span class="co"># Scene location</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">12.3</span>, <span class="co"># Solar zenith angle</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">56.7</span>, <span class="co"># Solar azimuth angle</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    time <span class="co"># Time of measurement</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>EarthScene</code></pre>
</div>
</div>
<p>Before moving on to use the scene object for computations, let us ponder the relationship and dependencies between the various objects we have created in order to build this. Understanding those connections is helpful since those reflect the needed paths of fundamental calculations that we require for most retrieval applications.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">---
config:
    class:
        hideEmptyMembersBox: true
---
classDiagram

    class SpectralWindow["SpectralWindow\n(shortened)"]{
        Number Œª_min
        Number Œª_max
    }

    class surfaces

    class LambertianPolynomialSurface["LambertianPolynomialSurface\n(shortened)"]

    class ABSCOSpectroscopy["ABSCOSpectroscopy\n(shortened)"]{
        String filename
    }

    class GasAbsorber["GasAbsorber\n(shortened)"]{
        ABSCOSpectroscopy spectroscopy
    }

    class EarthAtmosphere["EarthAtmosphere\n(shortened)"]{
        AtmosphereElements

        retrieval_pressure_grid
        met_pressure_grid
        met_profiles
        met_profiles_units

    }

    class EarthScene{
        Dict[SpectralWindow-&gt;AbstractSurfaces] surfaces
        EarthAtmosphere atm
        AbstractObserver observer
        AbstractLocation location
        Number solar_zenith
        Number solar_azimuth
        DateTime time
    }

    GasAbsorber &lt;-- ABSCOSpectroscopy
    EarthAtmosphere &lt;-- GasAbsorber
    EarthScene &lt;-- EarthAtmosphere
    EarthScene &lt;-- surfaces

    SpectralWindow --&gt; surfaces
    LambertianPolynomialSurface --&gt; surfaces

</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>The above schematic shows a stripped-down version of the actual objects and their fields, done mostly for clarity. The <code>EarthScene</code> object is situated at the top right of the diagram, and there are two arrows pointing inward to it. One of the paths show the atmosphere, as defined by the <code>EarthAtmosphere</code> object that contains the various retrieval and meteorological grids and profiles (see <a href="./tutorial_02.html">Tutorial 2</a>). The atmosphere may have some <code>AtmosphereElements</code>, such as a <code>GasAbsorber</code> which itself needs underlying spectrosopic data. The other arrow shows how surfaces are introduced into the scene. We must first create a surface of type <code>AbstractSurface</code>, in this case we use a <code>LambertianPolynomialSurface</code> - one that has some spectral variability through polynomial coefficients. Then we must have a spectral window to which the surface is attached to. The relationship between surface and spectral window is then determined by the dictionary which maps the spectral window to the surface.</p>
<p>Similarly to what we have done before, the convenience of this hierarchy becomes clear when we want to refer to any of the important quantities. Some function that gets passed a <code>EarthScene</code> object <code>scene</code>, can access all these data through the scene itself. For the solar zenith angle, a simple <code>scene.solar_zenith</code> is enough, the retrieval grid, for example, is accessed by <code>scene.atm.pressure_levels</code>. One can keep chaning the dot-operator to get lower-level data. For example, if one needed to write a small function that lists all the spectroscopy file paths for all gases used in this scene, one can do the following:</p>
<div id="bf189b8e" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">list_all_spec_fnames</span>(scene<span class="op">::</span><span class="dt">RE.EarthScene</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop through all atmosphere elements in the atmosphere</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ele <span class="kw">in</span> scene.atmosphere.atm_elements</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if this atmosphere element is a GasAbsorber type</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ele isa RE.GasAbsorber</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Finally, print out the gas name and the spectroscopy file name</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">println</span>(<span class="st">"Gas </span><span class="sc">$</span>(ele.gas_name)<span class="st"> is read from: </span><span class="sc">$</span>(ele.spectroscopy.file_name)<span class="st">"</span>)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that `scene` was defined above in the collapsed code cell</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="fu">list_all_spec_fnames</span>(scene)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Gas O2 is read from: data/o2_spectroscopy_demo.h5</code></pre>
</div>
</div>
<p>Now the above example highlights the way one can walk down the object hiearchy, starting from the uppermost available object (in this case the scene). Observant readers will notice, however, that this particular function does not need anything beyond the list of atmosphere elements, so one could have written the function so that it accepts either the <code>scene.atmosphere</code> or even <code>scene.atmosphere.atm_elements</code> as its argument. In general, most functions inside RetrievalToolbox are set up this way such that functions will operate on the ‚Äúhighest‚Äù <strong>required</strong> object, which in this case would be the atmosphere. Sometimes it is simply more convenient to have a function act on an object much higher in the hierarchy, for example when it reduces typing. To illustrate this on our example here, we define our function again, but let it act on the atmosphere object:</p>
<div id="961507ec" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">list_all_spec_fnames</span>(atmosphere<span class="op">::</span><span class="dt">RE.EarthAtmosphere</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Loop through all atmosphere elements in the atmosphere</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ele <span class="kw">in</span> atmosphere.atm_elements</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check if this atmosphere element is a GasAbsorber type</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ele isa RE.GasAbsorber</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Finally, print out the gas name and the spectroscopy file name</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">println</span>(<span class="st">"Gas </span><span class="sc">$</span>(ele.gas_name)<span class="st"> is read from: </span><span class="sc">$</span>(ele.spectroscopy.file_name)<span class="st">"</span>)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>list_all_spec_fnames (generic function with 2 methods)</code></pre>
</div>
</div>
<p>Now, we can create a very simply wrapper function that calls this for a scene object:</p>
<div id="8600ae6d" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This now overwrites our very fist function</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">list_all_spec_fnames</span>(scene<span class="op">::</span><span class="dt">EarthScene</span>) <span class="op">=</span> <span class="fu">list_all_spec_fnames</span>(scene.atmosphere)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>list_all_spec_fnames (generic function with 2 methods)</code></pre>
</div>
</div>
<p>This way, we now have two functions at our disposal. We can use this for an atmosphere object (when no scene has yet been created), and we can also use this for the scene itself to which the atmosphere is attached to. Further, the actual code that does the work is only implemented once, so we will only have to edit the code in one place to extend or improve the function, and the changes will occur for any other wrapper function!</p>
<div id="c5944507" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list_all_spec_fnames</span>(scene.atmosphere)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">list_all_spec_fnames</span>(scene)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Gas O2 is read from: data/o2_spectroscopy_demo.h5
Gas O2 is read from: data/o2_spectroscopy_demo.h5</code></pre>
</div>
</div>
</section>
</section>
<section id="optical-properties" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Optical Properties</h1>
<p>With the <code>EarthScene</code> object in place (including all objects within), we likely have everything needed that define an atmospheric and a surface state, from the point of view of an atmospheric retrieval. Between those states and an observable measurement lies the most major component of a retrieval algorithm: the radiative transfer - the mathematical description that provides a way of calculating how light interacts with an absorbing and potentially scattering atmosphere. Between a scene and the output of a radiative transfer calculation usually lies a more fundamental set of quantities, which we shall call <strong>optical properties</strong>. These represent mostly the raw inputs to the radiative transfer solvers. For now, RetrievalToolbox can utilize the <a href="https://github.com/gmcgarragh/xrtm">XRTM</a> (atmopsheric) radiative transfer model, which takes as inputs <strong>total optical properties</strong>, meaning that the RT code does not care about what molecule causes absorption, or what type of scatterer causes scattering. We have to break down our atmospheric state and calculate the resulting total optical properties to then feed into the RT model.</p>
<p>Since it is also very useful to be able to inspect these optical properties, RetrievalToolbox has an explicit type that holds all of this information: <code>EarthAtmosphereOpticalProperties</code>. Right below this paragraph is the documentation of the type including its fields.</p>
<div class="callout callout-style-default callout-note callout-titled" title="EarthAtmosphereOpticalProperties">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
EarthAtmosphereOpticalProperties
</div>
</div>
<div class="callout-body-container callout-body">
<div id="d4570cda" class="cell" data-execution_count="33">
<div class="cell-output cell-output-display cell-output-markdown" data-execution_count="34">
<div class="sourceCode" id="cb61"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> EarthAtmosphereOpticalProperties{T} <span class="op">&lt;:</span><span class="dt"> AbstractOpticalProperties</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Type to hold optical property data that contain all necessary information to produce the RT inputs for a spectral window <code>spectral_window</code>.</p>
<ul>
<li><code>spectral_window::AbstractSpectralWindow</code>: Spectral window for which to calculate optical properties</li>
<li><code>gas_tau::Dict{GasAbsorber{T}, Matrix{T}} where T</code>: Dictionary to map <code>GasAbsorber</code> -&gt; (wavelength, layer) array</li>
<li><code>gas_derivatives::Dict{GasAbsorber{T}, Dict{String, AbstractArray}} where T</code>: Dictionary to map <code>GasAbsorber</code> -&gt; Dict of string -&gt; (wavelength, layer) array</li>
<li><code>aerosol_tau::Dict{&lt;:AbstractAerosolType, Matrix{T}} where T</code>: Dictionary to map <code>AbstractAerosol</code> -&gt; (wavelength, layer) array for optical depth</li>
<li><code>aerosol_omega::Dict{&lt;:AbstractAerosolType, Matrix{T}} where T</code>: Dictionary to map <code>AbstractAerosol</code> -&gt; (wavelength, layer) array for single scatter albedo</li>
<li><code>rayleigh_tau::Matrix</code>: Rayleigh optical extinction array (wavelength, layer)</li>
<li><code>rayleigh_derivatives::Matrix</code>: Rayleigh optical extinction derivatives ‚àÇœÑray/‚àÇpsurf (wavelength, layer)</li>
<li><code>total_tau::Matrix</code>: Total extinction array (wavelength, layer)</li>
<li><code>total_omega::Matrix</code>: Total single scatter albedo (wavelength, layer)</li>
<li><code>total_coef::Union{Nothing, Array{T, 3}} where T</code>: Total phase function (matrix) expansion coefficient array (moment, element(s) - 1 for scalar, 6 for polarized, layer)</li>
<li><code>nair_dry::Vector</code>: Number of dry air molecules</li>
<li><code>nair_wet::Vector</code>: Number of wet air molecules</li>
<li><code>tmp_Nhi1::Vector</code></li>
<li><code>tmp_Nhi2::Vector</code></li>
<li><code>tmp_Nlay1::Vector</code></li>
<li><code>tmp_Nlay2::Vector</code></li>
<li><code>tmp_coef::Union{Nothing, Array{T, 3}} where T</code></li>
<li><code>tmp_coef_scalar::Union{Nothing, Array{T, 3}} where T</code></li>
</ul>
</div>
</div>
</div>
</div>
<div id="fc82547c" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> RE.<span class="fu">create_empty_EarthAtmosphereOpticalProperties</span>(</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    swin1, scene, RE.<span class="fu">RetrievalStateVector</span>([]), RE.ScalarRadiance, <span class="dt">Float64</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>EarthAtmosphereOpticalProperties{Float64}(SpectralWindow: O2A, Dict{GasAbsorber{Float64}, Matrix{Float64}}(GasAbsorber: O2 =&gt; [0.0 0.0 0.0; 0.0 0.0 0.0; ‚Ä¶ ; 0.0 0.0 0.0; 0.0 0.0 0.0]), Dict{GasAbsorber{Float64}, Dict{String, AbstractArray}}(GasAbsorber: O2 =&gt; Dict()), Dict{AbstractAerosolType, Matrix{Float64}}(), Dict{AbstractAerosolType, Matrix{Float64}}(), [0.0 0.0 0.0; 0.0 0.0 0.0; ‚Ä¶ ; 0.0 0.0 0.0; 0.0 0.0 0.0], [0.0 0.0 0.0; 0.0 0.0 0.0; ‚Ä¶ ; 0.0 0.0 0.0; 0.0 0.0 0.0], [0.0 0.0 0.0; 0.0 0.0 0.0; ‚Ä¶ ; 0.0 0.0 0.0; 0.0 0.0 0.0], [0.0 0.0 0.0; 0.0 0.0 0.0; ‚Ä¶ ; 0.0 0.0 0.0; 0.0 0.0 0.0], nothing, [0.0, 0.0, 0.0], [0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  ‚Ä¶  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  ‚Ä¶  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0], [0.0, 0.0, 0.0], nothing, nothing)</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>